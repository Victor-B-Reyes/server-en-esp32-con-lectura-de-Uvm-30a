<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Monitor UV ESP32</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #0077cc;
    }
    .card {
      display: inline-block;
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      min-width: 200px;
    }
    .value {
      font-size: 2em;
      color: #222;
    }
    .label {
      font-size: 0.9em;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Datos UV en tiempo real</h1>
  
  <div class="card">
    <div class="value" id="ip">-</div>
    <div class="label">IP ESP32</div>
  </div>

  <div class="card">
    <div class="value" id="voltaje">-</div>
    <div class="label">Voltaje (V)</div>
  </div>
  
  <div class="card">
    <div class="value" id="uvi">-</div>
    <div class="label">Índice UV</div>
  </div>

  <div class="card">
    <div class="value" id="irradiancia">-</div>
    <div class="label">Irradiancia (W/m²)</div>
  </div>

  <script>
    // Cambia la IP por la de tu ESP32
    const ESP32_IP = "IP";  
    const ws = new WebSocket(`ws://${ESP32_IP}:81/`);

    ws.onopen = () => {
      console.log("Conectado al WebSocket");
    };

    ws.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        document.getElementById("ip").innerText = data.ip || ESP32_IP;
        document.getElementById("voltaje").innerText = (data.voltaje || 0).toFixed(3);
        document.getElementById("uvi").innerText = (data.uvi || 0).toFixed(2);
        document.getElementById("irradiancia").innerText = (data.irradiancia_wm2 || 0).toFixed(3);
      } catch (e) {
        console.error("Error parsing JSON:", e);
      }
    };

    ws.onclose = () => {
      console.log("WebSocket cerrado, recargando en 5s...");
      setTimeout(() => location.reload(), 5000);
    };
  </script>
</body>
</html>
